<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redview Groups</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-storage-compat.js"></script>
    
    <style>
        /* Definir la fuente personalizada */
        @font-face {
            font-family: 'FuentePersonalizada';
            src: url('fuente.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
        
        /* APLICAR FUENTE PERSONALIZADA A TODOS LOS ELEMENTOS Y TEXTOS */
        body, .title, .menu-title, 
        .card-title, .card-description,
        .group-title, .group-description,
        .publish-date, .form-label,
        .stat-label, .tag,
        .my-group-placeholder p,
        .my-group-stat-number, .my-group-stat-label, .my-group-tag,
        button, .card-button, .join-button, .publish-footer-button,
        .form-input, .publish-button, .close-menu, .back-button,
        .nav-label, .group-status, .stat-number,
        .admin-input, .admin-button, .request-item, .request-title,
        .request-description, .admin-section-title, .admin-actions,
        .admin-stats-number, .admin-stats-label, .admin-tab-button,
        .review-link-btn, .search-input, .close-search,
        .notification-title, .notification-message, .notification-date,
        .notification-send-btn, .notification-input {
            font-family: 'FuentePersonalizada', Arial, sans-serif !important;
        }
        
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            background-color: #121212;
            color: #ffffff;
            overflow-x: hidden;
        }
        
        .top-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background-color: #121212;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 1px solid #333;
            z-index: 100;
            height: 60px;
            box-sizing: border-box;
        }
        
        .title {
            font-size: 18px;
            font-weight: bold;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        
        .title:hover {
            opacity: 0.8;
        }
        
        .heart {
            margin-right: 8px;
            font-size: 20px;
        }
        
        .search-icon {
            width: 24px;
            height: 24px;
            object-fit: contain;
            filter: brightness(0.9);
            cursor: pointer;
            display: block;
        }
        
        /* BARRA DE B√öSQUEDA - MISMO TAMA√ëO QUE TOP-BAR */
        .search-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background-color: #121212;
            display: none;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 1px solid #333;
            z-index: 101;
            height: 60px;
            box-sizing: border-box;
        }
        
        .search-input-container {
            flex-grow: 1;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .search-input {
            flex-grow: 1;
            padding: 12px 16px;
            background-color: #2a2a2a;
            border: 1px solid #444;
            border-radius: 50px; /* ESQUINAS MUY REDONDEADAS */
            color: #fff;
            font-size: 14px;
            outline: none; /* QUITAR CONTORNO AZUL */
            transition: border-color 0.2s;
        }
        
        /* QUITAR CONTORNO AZUL COMPLETAMENTE AL ENFOCAR */
        .search-input:focus {
            border-color: #444; /* MANTENER EL MISMO COLOR DE BORDE */
            box-shadow: none; /* ELIMINAR CUALQUIER SOMBRA */
            outline: none; /* ELIMINAR OUTLINE */
        }
        
        /* QUITAR ESTILOS DE AUTORRELLENO DE CHROME */
        .search-input:-webkit-autofill,
        .search-input:-webkit-autofill:hover,
        .search-input:-webkit-autofill:focus {
            -webkit-text-fill-color: #fff;
            -webkit-box-shadow: 0 0 0px 1000px #2a2a2a inset;
            transition: background-color 5000s ease-in-out 0s;
            border: 1px solid #444;
            border-radius: 50px;
        }
        
        .close-search {
            background-color: #2a2a2a;
            color: white;
            border: none;
            border-radius: 50%; /* FONDO PERFECTAMENTE REDONDEADO */
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            transition: background-color 0.2s;
            flex-shrink: 0;
            outline: none; /* QUITAR CONTORNO AZUL */
        }
        
        .close-search:hover {
            background-color: #3a3a3a;
        }
        
        /* QUITAR CONTORNO AZUL AL ENFOCAR EL BOT√ìN */
        .close-search:focus {
            outline: none;
            box-shadow: none;
        }
        
        /* MODAL DE CONTRASE√ëA ADMIN */
        .admin-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        
        .admin-modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .admin-modal {
            background-color: #1e1e1e;
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            text-align: center;
            transform: translateY(-20px);
            transition: transform 0.3s ease;
        }
        
        .admin-modal-overlay.active .admin-modal {
            transform: translateY(0);
        }
        
        .admin-modal-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #fff;
        }
        
        .admin-modal-subtitle {
            font-size: 14px;
            color: #bbb;
            margin-bottom: 25px;
        }
        
        .admin-modal-input {
            width: 100%;
            padding: 14px;
            background-color: #2a2a2a;
            border: 2px solid #444;
            border-radius: 10px;
            color: #fff;
            font-size: 16px;
            margin-bottom: 20px;
            text-align: center;
            transition: border-color 0.2s;
        }
        
        .admin-modal-input:focus {
            outline: none;
            border-color: #2575fc;
        }
        
        .admin-modal-input::placeholder {
            color: #777;
        }
        
        .admin-modal-button {
            width: 100%;
            padding: 14px;
            background-color: #2575fc;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-bottom: 15px;
        }
        
        .admin-modal-button:hover {
            background-color: #1c64e0;
        }
        
        .admin-modal-close {
            background: none;
            border: none;
            color: #bbb;
            font-size: 14px;
            cursor: pointer;
            margin-top: 10px;
            transition: color 0.2s;
        }
        
        .admin-modal-close:hover {
            color: #fff;
        }
        
        /* Contenido principal - M√ÅS ESPACIO ARRIBA */
        .main-content {
            padding: 75px 16px 120px; /* AUMENTADO DE 60px A 75px */
            max-width: 800px;
            margin: 0 auto;
            transition: opacity 0.3s ease;
        }
        
        /* Contenido para Mis Grupos (oculto por defecto) */
        .my-groups-content {
            padding: 75px 16px 120px; /* AUMENTADO DE 60px A 75px */
            max-width: 800px;
            margin: 0 auto;
            display: none;
        }
        
        /* Contenido para Admin (oculto por defecto) */
        .admin-content {
            padding: 75px 16px 120px; /* AUMENTADO DE 60px A 75px */
            max-width: 800px;
            margin: 0 auto;
            display: none;
        }
        
        body.show-my-groups .main-content {
            display: none;
        }
        
        body.show-my-groups .my-groups-content {
            display: block;
        }
        
        body.show-admin .main-content {
            display: none;
        }
        
        body.show-admin .admin-content {
            display: block;
        }
        
        body.show-admin .my-groups-content {
            display: none;
        }
        
        /* DOS COLUMNAS SIEMPRE */
        .cards-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            width: 100%;
        }
        
        /* UNA COLUMNA PARA MIS GRUPOS */
        .my-groups-container {
            display: flex;
            flex-direction: column;
            gap: 16px;
            width: 100%;
        }
        
        /* CONTENEDOR PARA SOLICITUDES DE ADMIN */
        .requests-container {
            display: flex;
            flex-direction: column;
            gap: 16px;
            width: 100%;
        }
        
        /* RECUADRO DE ESTAD√çSTICAS ADMIN */
        .admin-stats-container {
            background-color: #1e1e1e;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .admin-stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            background-color: #2a2a2a;
            border-radius: 12px;
        }
        
        .admin-stats-number {
            font-size: 32px;
            font-weight: bold;
            color: #ffffff;
            margin-bottom: 8px;
        }
        
        .admin-stats-label {
            font-size: 14px;
            color: #bbb;
        }
        
        /* PESTA√ëAS DE ADMIN */
        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            background-color: #2a2a2a;
            border-radius: 12px;
            padding: 6px;
        }
        
        .admin-tab-button {
            flex: 1;
            padding: 12px;
            background: none;
            border: none;
            border-radius: 8px;
            color: #bbb;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .admin-tab-button.active {
            background-color: #2575fc;
            color: white;
        }
        
        .admin-tab-button:hover:not(.active) {
            background-color: #3a3a3a;
            color: #ddd;
        }
        
        /* CONTENIDO DE LAS PESTA√ëAS (oculto por defecto) */
        .admin-tab-content {
            display: none;
        }
        
        .admin-tab-content.active {
            display: block;
        }
        
        /* NOTIFICACIONES */
        .notification-container {
            background-color: #1e1e1e;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .notification-form .form-group {
            margin-bottom: 20px;
        }
        
        .notification-input {
            width: 100%;
            padding: 14px;
            background-color: #2a2a2a;
            border: 1px solid #444;
            border-radius: 10px;
            color: #fff;
            font-size: 14px;
            box-sizing: border-box;
            transition: border-color 0.2s;
            resize: vertical;
        }
        
        .notification-input:focus {
            outline: none;
            border-color: #2575fc;
        }
        
        .notification-send-btn {
            width: 100%;
            padding: 14px;
            background-color: #2ecc71;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .notification-send-btn:hover {
            background-color: #27ae60;
        }
        
        .notification-send-btn:disabled {
            background-color: #666;
            cursor: not-allowed;
        }
        
        .notification-item {
            background-color: #2a2a2a;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            border-left: 4px solid #3498db;
        }
        
        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }
        
        .notification-title {
            font-size: 16px;
            font-weight: bold;
            color: #fff;
            margin: 0;
            flex-grow: 1;
        }
        
        .notification-date {
            font-size: 12px;
            color: #bbb;
            white-space: nowrap;
            margin-left: 10px;
        }
        
        .notification-message {
            font-size: 14px;
            color: #ddd;
            line-height: 1.4;
            margin: 0;
        }
        
        .delete-notification-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 4px 10px;
            font-size: 12px;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-top: 10px;
        }
        
        .delete-notification-btn:hover {
            background-color: #c0392b;
        }
        
        /* IMAGEN EN SOLICITUDES PENDIENTES */
        .request-image-container {
            width: 100%;
            height: 150px;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 12px;
        }
        
        .request-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .request-item {
            background-color: #1e1e1e;
            border-radius: 15px;
            padding: 16px;
            margin-bottom: 12px;
            border-left: 4px solid #f39c12;
        }
        
        .request-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .request-title {
            font-size: 16px;
            font-weight: bold;
            color: #fff;
            margin: 0;
        }
        
        .request-date {
            font-size: 12px;
            color: #bbb;
        }
        
        .request-description {
            font-size: 14px;
            color: #ddd;
            line-height: 1.4;
            margin-bottom: 12px;
        }
        
        .request-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .request-tag {
            background-color: #2a2a2a;
            color: #ddd;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
        }
        
        /* ACTUALIZADO: TODOS LOS BOTONES EN LA MISMA L√çNEA */
        .request-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            align-items: center;
            flex-wrap: wrap;
        }
        
        /* Asegurar que todos los botones tengan el mismo estilo base */
        .request-actions .review-link-btn,
        .request-actions .reject-btn,
        .request-actions .accept-btn {
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s;
            border: none;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .review-link-btn {
            background-color: #3498db;
            color: white;
        }
        
        .review-link-btn:hover {
            background-color: #2980b9;
        }
        
        .accept-btn {
            background-color: #2ecc71;
            color: white;
        }
        
        .accept-btn:hover {
            background-color: #27ae60;
        }
        
        .reject-btn {
            background-color: #e74c3c;
            color: white;
        }
        
        .reject-btn:hover {
            background-color: #c0392b;
        }
        
        .admin-section-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #fff;
            text-align: center;
        }
        
        .admin-input-container {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            margin-bottom: 20px;
        }
        
        .admin-input {
            flex-grow: 1;
            padding: 10px 14px;
            background-color: #2a2a2a;
            border: 1px solid #444;
            border-radius: 10px;
            color: #fff;
            font-size: 14px;
        }
        
        .admin-button {
            padding: 10px 20px;
            background-color: #2575fc;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .admin-button:hover {
            background-color: #1c64e0;
        }
        
        .card {
            background-color: #1e1e1e;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            width: 100%;
            min-width: 0;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
        }
        
        .card-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
        }
        
        .card-content {
            padding: 12px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        
        .card-title {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 6px;
            color: #ffffff;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .card-description {
            font-size: 12px;
            color: #bbb;
            line-height: 1.4;
            margin-bottom: 12px;
            flex-grow: 1;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
        }
        
        .card-button {
            display: block;
            width: 100%;
            padding: 8px;
            background-color: #2ecc71;
            color: white;
            border: none;
            border-radius: 100px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
            text-align: center;
            text-decoration: none;
            box-sizing: border-box;
        }
        
        .card-button:hover {
            background-color: #27ae60;
        }
        
        /* BOT√ìN DE ELIMINAR EN ADMIN PUBLISHED */
        .admin-delete-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px 12px;
            font-size: 12px;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-top: 10px;
            width: 100%;
        }
        
        .admin-delete-btn:hover {
            background-color: #c0392b;
        }
        
        /* ETIQUETAS EN MIS GRUPOS - ALINEADAS A LA IZQUIERDA */
        .my-group-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 12px;
            padding: 0;
        }
        
        .my-group-tag {
            background-color: #2a2a2a;
            color: #ddd;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 10px;
        }
        
        /* PIE DE TARJETA EN MIS GRUPOS CON DOS COLUMNAS */
        .my-group-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
            padding-top: 10px;
            border-top: 1px solid #333;
        }
        
        /* ESTAD√çSTICAS EN LADO IZQUIERDO */
        .my-group-stats {
            display: flex;
            gap: 16px;
        }
        
        .my-group-stat {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .my-group-stat-number {
            font-size: 14px;
            font-weight: bold;
            color: #ffffff;
        }
        
        .my-group-stat-label {
            font-size: 9px;
            color: #bbb;
            margin-top: 2px;
        }
        
        /* ESTADO DEL GRUPO EN LADO DERECHO - BORDE REDONDEADO AL M√ÅXIMO */
        .group-status {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 100px;
            font-size: 11px;
            font-weight: bold;
            text-align: center;
            white-space: nowrap;
        }
        
        .status-review {
            background-color: #f39c12;
            color: white;
        }
        
        .status-published {
            background-color: #2ecc71;
            color: white;
        }
        
        .status-rejected {
            background-color: #e74c3c;
            color: white;
        }
        
        /* MEN√ö LATERAL DE PUBLICACI√ìN DESDE LA DERECHA */
        .side-menu {
            position: fixed;
            top: 0;
            right: -100%;
            width: 100%;
            height: 100vh;
            background-color: #121212;
            z-index: 1000;
            transition: right 0.3s ease;
            overflow-y: auto;
        }
        
        body.menu-open .side-menu {
            right: 0;
        }
        
        /* MEN√ö LATERAL DE DETALLES DEL GRUPO */
        .group-details-menu {
            position: fixed;
            top: 0;
            right: -100%;
            width: 100%;
            height: 100vh;
            background-color: #1a1a1a;
            z-index: 1000;
            transition: right 0.3s ease;
            overflow-y: auto;
        }
        
        body.group-details-open .group-details-menu {
            right: 0;
        }
        
        /* Overlay para cerrar los men√∫s */
        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        
        body.menu-open .menu-overlay,
        body.group-details-open .menu-overlay {
            opacity: 1;
            visibility: visible;
        }
        
        /* BARRA SUPERIOR DENTRO DEL GRUPO - DEBE MOVERSE CON EL DESPLAZAMIENTO */
        .details-header {
            background-color: #121212;
            padding: 16px;
            border-bottom: 1px solid #333;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .back-button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .back-arrow {
            width: 24px;
            height: 24px;
            object-fit: contain;
        }
        
        .publish-date {
            font-size: 14px;
            color: #bbb;
            flex-grow: 1;
            text-align: center;
        }
        
        /* Contenido del men√∫ de detalles - M√ÅS ESPACIO PARA DESPLAZAMIENTO */
        .details-content {
            padding: 0;
            max-width: 500px;
            margin: 0 auto;
            padding-bottom: 100px;
        }
        
        /* IMAGEN DEL GRUPO CON M√ÅRGENES Y ESQUINAS REDONDEADAS */
        .group-image-large {
            width: calc(100% - 40px);
            height: 200px;
            object-fit: cover;
            border-radius: 15px;
            margin: 20px auto;
            display: block;
        }
        
        .group-title {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #ffffff;
            padding: 0 20px;
        }
        
        .group-description {
            font-size: 16px;
            color: #ddd;
            line-height: 1.6;
            margin-bottom: 20px;
            padding: 0 20px;
        }
        
        .group-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 25px;
            padding: 0 20px;
        }
        
        .tag {
            background-color: #2a2a2a;
            color: #ddd;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
        }
        
        /* Recuadro de estad√≠sticas - SOLO 2 ESTAD√çSTICAS */
        .stats-container {
            background-color: #2a2a2a;
            border-radius: 15px;
            padding: 20px;
            margin: 0 20px 25px 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            text-align: center;
        }
        
        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #ffffff;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 12px;
            color: #bbb;
        }
        
        /* Barra inferior del men√∫ de detalles - BOT√ìN COMO ENLACE */
        .details-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: #1e1e1e;
            padding: 16px;
            border-top: 1px solid #333;
            display: flex;
            align-items: center;
            z-index: 1001;
            display: none;
        }
        
        body.group-details-open .details-footer {
            display: flex;
        }
        
        .join-button {
            flex-grow: 1;
            padding: 14px;
            background-color: #2ecc71;
            color: white;
            border: none;
            border-radius: 100px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
            text-decoration: none;
            text-align: center;
        }
        
        .join-button:hover {
            background-color: #27ae60;
        }
        
        /* Contenido del men√∫ lateral de publicaci√≥n */
        .menu-content {
            padding: 20px;
            max-width: 500px;
            margin: 0 auto;
            padding-bottom: 100px;
        }
        
        /* Barra superior del men√∫ de publicaci√≥n - M√ÅS DELGADA */
        .menu-header {
            background-color: #121212;
            padding: 10px 16px;
            border-bottom: 1px solid #333;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .menu-title {
            font-size: 18px;
            font-weight: bold;
        }
        
        /* Barra inferior del men√∫ de publicaci√≥n */
        .publish-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: #1e1e1e;
            padding: 16px;
            border-top: 1px solid #333;
            display: flex;
            align-items: center;
            z-index: 1001;
            display: none;
        }
        
        body.menu-open .publish-footer {
            display: flex;
        }
        
        .publish-footer-button {
            flex-grow: 1;
            padding: 14px;
            background-color: #2575fc;
            color: white;
            border: none;
            border-radius: 100px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .publish-footer-button:hover {
            background-color: #1c64e0;
        }
        
        /* Bot√≥n de cerrar el men√∫ de publicaci√≥n - X NORMAL */
        .close-menu {
            background: none;
            border: none;
            color: #fff;
            font-size: 32px;
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s;
        }
        
        .close-menu:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        /* Imagen redondeada para seleccionar */
        .image-upload {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background-color: #2a2a2a;
            margin: 0 auto 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 2px dashed #444;
            transition: border-color 0.2s, background-color 0.2s;
            position: relative;
            overflow: hidden;
        }
        
        .image-upload:hover {
            border-color: #2575fc;
            background-color: #2d2d2d;
        }
        
        .image-upload-icon {
            font-size: 28px;
            margin-bottom: 6px;
        }
        
        .image-upload-text {
            font-size: 10px;
            color: #aaa;
            text-align: center;
            padding: 0 5px;
        }
        
        .image-preview {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
            position: absolute;
            top: 0;
            left: 0;
            display: none;
        }
        
        .image-upload.has-image .image-upload-icon,
        .image-upload.has-image .image-upload-text {
            display: none;
        }
        
        .image-upload.has-image .image-preview {
            display: block;
        }
        
        .upload-input {
            display: none;
        }
        
        /* Campos del formulario */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            font-size: 14px;
            margin-bottom: 8px;
            color: #ddd;
        }
        
        .form-input {
            width: 100%;
            padding: 12px 14px;
            background-color: #2a2a2a;
            border: 1px solid #444;
            border-radius: 10px;
            color: #fff;
            font-size: 14px;
            box-sizing: border-box;
            transition: border-color 0.2s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #2575fc;
        }
        
        .form-input::placeholder {
            color: #777;
        }
        
        textarea.form-input {
            resize: vertical;
            min-height: 80px;
        }
        
        /* Bot√≥n de publicar (ahora eliminado, est√° en la barra inferior) */
        .publish-button {
            display: none;
        }
        
        /* Barra inferior principal - CON NUEVOS NOMBRES */
        .bottom-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: #1e1e1e;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 8px 0;
            border-top: 1px solid #333;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.2);
            z-index: 100;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: #bbb;
            flex: 1;
            padding: 6px 0;
            transition: color 0.2s;
            outline: none;
            -webkit-tap-highlight-color: transparent;
            cursor: pointer;
        }
        
        .nav-item.active {
            color: #ffffff;
        }
        
        .nav-item:focus, .nav-item:active {
            outline: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        .nav-item:hover {
            color: #ffffff;
        }
        
        .nav-icon {
            width: 22px;
            height: 22px;
            object-fit: contain;
            margin-bottom: 4px;
            filter: brightness(0.9);
            transition: filter 0.2s;
        }
        
        .nav-item.active .nav-icon {
            filter: brightness(1);
        }
        
        .nav-label {
            font-size: 10px;
            font-weight: 500;
        }
        
        /* Bot√≥n del medio m√°s destacado */
        .center-button {
            position: relative;
            z-index: 1;
        }
        
        .center-button .nav-icon {
            width: 26px;
            height: 26px;
        }
        
        .center-button .nav-label {
            font-weight: 600;
        }
        
        /* Quitar el recuadro azul en navegadores webkit */
        * {
            -webkit-tap-highlight-color: transparent;
            box-sizing: border-box;
        }
        
        /* Ajustes para pantallas MUY peque√±as */
        @media (max-width: 360px) {
            .card-image {
                height: 100px;
            }
            
            .card-content {
                padding: 10px;
            }
            
            .card-title {
                font-size: 13px;
            }
            
            .card-description {
                font-size: 11px;
            }
            
            .cards-container {
                gap: 10px;
            }
            
            .main-content, .my-groups-content, .admin-content {
                padding: 70px 12px 120px; /* Ajustado para pantallas peque√±as */
            }
            
            .menu-content, .details-content {
                padding: 0;
            }
            
            .group-image-large {
                height: 150px;
                width: calc(100% - 30px);
                border-radius: 12px;
            }
            
            .group-title {
                font-size: 18px;
            }
            
            .group-description {
                font-size: 14px;
            }
            
            .stats-container {
                margin: 0 15px 25px 15px;
            }
            
            .menu-content {
                padding-bottom: 90px;
            }
            
            .group-status {
                padding: 5px 12px;
                font-size: 10px;
            }
            
            .my-group-stat-number {
                font-size: 12px;
            }
            
            .my-group-stat-label {
                font-size: 8px;
            }
            
            .request-item {
                padding: 12px;
            }
            
            .request-title {
                font-size: 14px;
            }
            
            .request-description {
                font-size: 12px;
            }
            
            .admin-modal {
                padding: 20px;
                width: 95%;
            }
            
            .admin-modal-title {
                font-size: 20px;
            }
            
            .admin-stats-number {
                font-size: 24px;
            }
            
            .admin-stats-label {
                font-size: 12px;
            }
            
            .request-image-container {
                height: 120px;
            }
            
            /* Ajustes para botones en l√≠nea en pantallas peque√±as */
            .request-actions {
                flex-direction: column;
                gap: 8px;
            }
            
            .request-actions .review-link-btn,
            .request-actions .reject-btn,
            .request-actions .accept-btn {
                width: 100%;
            }
            
            /* Ajustes para barra de b√∫squeda en pantallas peque√±as */
            .search-input {
                padding: 10px 14px;
                font-size: 13px;
            }
            
            .close-search {
                width: 36px;
                height: 36px;
                font-size: 18px;
            }
            
            .top-bar, .search-bar {
                height: 56px;
                padding: 10px 14px;
            }
            
            /* Bot√≥n de editar en mis grupos */
            .edit-group-btn {
                padding: 4px 8px !important;
                font-size: 10px !important;
            }
            
            /* Notificaciones en pantallas peque√±as */
            .notification-item {
                padding: 12px;
            }
            
            .notification-title {
                font-size: 14px;
            }
            
            .notification-message {
                font-size: 12px;
            }
        }
        
        /* Bot√≥n de editar en mis grupos */
        .edit-group-btn {
            background: none;
            border: 1px solid #3498db;
            color: #3498db;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
            margin-left: 10px;
        }
        
        .edit-group-btn:hover {
            background-color: #3498db;
            color: white;
        }
        
        /* Bot√≥n de eliminar en mis grupos */
        .delete-group-btn {
            background: none;
            border: 1px solid #e74c3c;
            color: #e74c3c;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .delete-group-btn:hover {
            background-color: #e74c3c;
            color: white;
        }
        
        /* Contenedor de acciones en mis grupos */
        .my-group-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            justify-content: flex-end;
        }
        
        /* Para pantallas m√°s grandes, dar un ancho fijo a los men√∫s */
        @media (min-width: 768px) {
            .side-menu, .group-details-menu {
                width: 400px;
                right: -400px;
            }
            
            .menu-content, .details-content {
                max-width: 350px;
            }
            
            .details-content {
                padding-bottom: 100px;
            }
            
            .details-footer, .publish-footer {
                width: 400px;
                left: auto;
                right: 0;
            }
            
            .group-image-large {
                width: calc(100% - 40px);
                border-radius: 15px;
            }
        }
        
        /* LOADING SPINNER */
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-left-color: #2575fc;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Barra superior con t√≠tulo y lupa -->
    <header class="top-bar">
        <div class="title" id="adminTitleButton">
            <span class="heart">‚ù§Ô∏è‚Äçüî•</span>
            <span> Ä·¥á·¥Ö·¥†…™·¥á·¥°</span>
        </div>
        <img src="https://i.ibb.co/n84F5wwC/lupa.png" alt="Buscar" class="search-icon" id="searchIcon">
    </header>
    
    <!-- Barra de b√∫squeda (oculta inicialmente) -->
    <div class="search-bar" id="searchBar">
        <div class="search-input-container">
            <input type="text" class="search-input" id="searchInput" placeholder="Buscar por etiquetas (ej: finanzas, tecnolog√≠a)...">
            <button class="close-search" id="closeSearch">√ó</button>
        </div>
    </div>

    <!-- MODAL DE CONTRASE√ëA ADMIN -->
    <div class="admin-modal-overlay" id="adminModalOverlay">
        <div class="admin-modal">
            <h2 class="admin-modal-title">Acceso de Administrador</h2>
            <p class="admin-modal-subtitle">Ingresa la contrase√±a para convertirte en administrador</p>
            <input type="password" class="admin-modal-input" id="adminModalPassword" placeholder="Contrase√±a">
            <button class="admin-modal-button" id="adminModalSubmit">Acceder</button>
            <button class="admin-modal-close" id="adminModalClose">Cancelar</button>
        </div>
    </div>

    <!-- Contenido principal con DOS tarjetas - CONTENIDO ADULTO -->
    <main class="main-content">
        <div class="loading-spinner" id="mainLoading">
            <div class="spinner"></div>
            <p>Cargando grupos...</p>
        </div>
        <div class="cards-container" id="mainCardsContainer">
            <!-- Los grupos publicados aparecer√°n aqu√≠ din√°micamente desde Firebase -->
        </div>
    </main>

    <!-- CONTENIDO PARA MIS GRUPOS -->
    <div class="my-groups-content">
        <div class="loading-spinner" id="myGroupsLoading">
            <div class="spinner"></div>
            <p>Cargando tus grupos...</p>
        </div>
        <div class="my-groups-container" id="myGroupsContainer">
            <!-- Los grupos del usuario aparecer√°n aqu√≠ desde Firebase -->
        </div>
</div>

    <!-- CONTENIDO PARA ADMIN -->
    <div class="admin-content">
        <h2 class="admin-section-title">Panel de Administraci√≥n</h2>
        
        <!-- RECUADRO DE ESTAD√çSTICAS -->
        <div class="admin-stats-container">
            <div class="admin-stat-item">
                <div class="admin-stats-number" id="statsPublished">0</div>
                <div class="admin-stats-label">Grupos Publicados</div>
            </div>
            <div class="admin-stat-item">
                <div class="admin-stats-number" id="statsPending">0</div>
                <div class="admin-stats-label">Grupos en Espera</div>
            </div>
        </div>
        
        <!-- PESTA√ëAS PARA CAMBIAR ENTRE VISTAS -->
        <div class="admin-tabs">
            <button class="admin-tab-button active" id="pendingTab">Solicitudes Pendientes</button>
            <button class="admin-tab-button" id="publishedTab">Grupos Publicados</button>
            <button class="admin-tab-button" id="notificationsTab">Notificaciones</button>
        </div>
        
        <!-- CONTENIDO DE SOLICITUDES PENDIENTES -->
        <div class="admin-tab-content active" id="pendingContent">
            <div class="loading-spinner" id="pendingLoading">
                <div class="spinner"></div>
                <p>Cargando solicitudes...</p>
            </div>
            <div class="requests-container" id="requestsContainer">
                <!-- Las solicitudes de publicaci√≥n aparecer√°n aqu√≠ desde Firebase -->
            </div>
        </div>
        
        <!-- CONTENIDO DE GRUPOS PUBLICADOS -->
        <div class="admin-tab-content" id="publishedContent">
            <div class="loading-spinner" id="publishedLoading">
                <div class="spinner"></div>
                <p>Cargando grupos publicados...</p>
            </div>
            <div class="my-groups-container" id="adminPublishedContainer">
                <!-- Los grupos publicados aparecer√°n aqu√≠ desde Firebase -->
            </div>
        </div>
        
        <!-- CONTENIDO DE NOTIFICACIONES -->
        <div class="admin-tab-content" id="notificationsContent">
            <div class="notification-container">
                <h3 class="admin-section-title">Enviar Notificaci√≥n a Todos los Usuarios</h3>
                <div class="notification-form">
                    <div class="form-group">
                        <label class="form-label" for="notificationTitle">T√≠tulo de la notificaci√≥n</label>
                        <input type="text" id="notificationTitle" class="notification-input" placeholder="T√≠tulo de la notificaci√≥n (opcional)">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="notificationMessage">Mensaje de la notificaci√≥n</label>
                        <textarea id="notificationMessage" class="notification-input" rows="5" placeholder="Escribe el mensaje que quieres enviar a todos los usuarios..."></textarea>
                    </div>
                    <button class="notification-send-btn" id="sendNotificationButton">Enviar Notificaci√≥n</button>
                </div>
            </div>
            
            <div class="notification-container">
                <h3 class="admin-section-title">Notificaciones Enviadas</h3>
                <div class="loading-spinner" id="notificationsLoading">
                    <div class="spinner"></div>
                    <p>Cargando notificaciones...</p>
                </div>
                <div class="requests-container" id="notificationsContainer">
                    <!-- Las notificaciones aparecer√°n aqu√≠ desde Firebase -->
                </div>
            </div>
        </div>
    </div>

    <!-- MEN√ö LATERAL DE PUBLICACI√ìN DESDE LA DERECHA -->
    <div class="side-menu">
        <div class="menu-header">
            <div class="menu-title" id="menuTitle">üìä PUBLICAR MIS GRUPOS</div>
            <button class="close-menu">√ó</button>
        </div>
        
        <div class="menu-content">
            <!-- Imagen redondeada para seleccionar -->
            <div class="image-upload" id="imageUpload">
                <div class="image-upload-icon">üñºÔ∏è</div>
                <div class="image-upload-text">Seleccionar imagen</div>
                <img src="" alt="Vista previa" class="image-preview" id="imagePreview">
                <input type="file" accept="image/*" class="upload-input" id="fileInput">
            </div>
            
            <!-- Campos del formulario -->
            <div class="form-group">
                <label class="form-label" for="groupName">Nombre del grupo</label>
                <input type="text" id="groupName" class="form-input" placeholder="Ej: Inversiones Internacionales">
            </div>
            
            <div class="form-group">
                <label class="form-label" for="groupDescription">Descripci√≥n</label>
                <textarea id="groupDescription" class="form-input" rows="3" placeholder="Describe de qu√© trata el grupo..."></textarea>
            </div>
            
            <div class="form-group">
                <label class="form-label" for="groupTags">Etiquetas</label>
                <input type="text" id="groupTags" class="form-input" placeholder="Ej: finanzas, inversiones, negocios">
            </div>
            
            <div class="form-group">
                <label class="form-label" for="groupLink">Enlace del grupo</label>
                <input type="url" id="groupLink" class="form-input" placeholder="https://ejemplo.com/grupo">
            </div>
            
            <!-- Campo oculto para el ID del grupo que se est√° editando -->
            <input type="hidden" id="editingGroupId" value="">
            <input type="hidden" id="editingGroupType" value="">
            
            <!-- Bot√≥n para publicar (OCULTO, AHORA EST√Å EN LA BARRA INFERIOR) -->
            <button class="publish-button" id="publishButton">Publicar grupo</button>
        </div>
        
        <!-- BARRA INFERIOR PARA PUBLICAR GRUPO -->
        <div class="publish-footer">
            <button class="publish-footer-button" id="publishFooterButton">Publicar grupo</button>
        </div>
    </div>
    
    <!-- MEN√ö LATERAL DE DETALLES DEL GRUPO -->
    <div class="group-details-menu">
        <div class="details-content">
            <!-- BARRA SUPERIOR STICKY QUE SE MUEVA CON EL DESPLAZAMIENTO -->
            <div class="details-header">
                <button class="back-button" id="backButton">
                    <img src="https://i.ibb.co/k6Vmd994/flecha.png" alt="Volver" class="back-arrow">
                </button>
                <div class="publish-date" id="publishDate">Publicado: 15 de marzo, 2024</div>
                <div style="width: 40px;"></div>
            </div>
            
            <!-- IMAGEN CON M√ÅRGENES Y ESQUINAS REDONDEADAS -->
            <img src="" alt="Imagen del grupo" class="group-image-large" id="groupImageLarge">
            
            <h2 class="group-title" id="groupTitle"></h2>
            
            <p class="group-description" id="groupDescriptionDetails"></p>
            
            <div class="group-tags" id="groupTagsDetails"></div>
            
            <!-- ESTAD√çSTICAS SOLO CON 2 ELEMENTOS -->
            <div class="stats-container">
                <div class="stat-item">
                    <div class="stat-number" id="viewsCount">0</div>
                    <div class="stat-label">Visualizaciones</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="membersCount">0</div>
                    <div class="stat-label">Uniones</div>
                </div>
            </div>
        </div>
        
        <!-- BARRA INFERIOR CON ENLACE PARA UNIRSE -->
        <div class="details-footer">
            <a href="#" target="_blank" class="join-button" id="joinButton">Unirse al grupo</a>
        </div>
    </div>
    
    <!-- Overlay para cerrar los men√∫s -->
    <div class="menu-overlay" id="menuOverlay"></div>

    <!-- Barra inferior con NUEVOS NOMBRES -->
    <footer class="bottom-bar">
        <div class="nav-item active" id="homeButton">
            <img src="https://i.ibb.co/Z1wD350f/home.png" alt="Inicio" class="nav-icon">
            <span class="nav-label">Inicio</span>
        </div>
        
        <div class="nav-item center-button" id="menuButton">
            <img src="https://i.ibb.co/qF03jpFH/mas.png" alt="Publicar" class="nav-icon">
            <span class="nav-label">Publicar</span>
        </div>
        
        <div class="nav-item" id="myGroupsButton">
            <img src="https://i.ibb.co/7JZmyK0w/publicacion.png" alt="Mis grupos" class="nav-icon">
            <span class="nav-label">Mis grupos</span>
        </div>
        
        <!-- Bot√≥n de Admin (oculto por defecto) CON NUEVO ICONO -->
        <div class="nav-item" id="adminButton" style="display: none;">
            <img src="https://i.ibb.co/V6N69ZM/escudo-antimalware.png" alt="Admin" class="nav-icon">
            <span class="nav-label">Admin</span>
        </div>
    </footer>

    <script>
        // Configuraci√≥n de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyB6SoLg-a8bZG9KSdFRH4NyoBDCps0dYCg",
            authDomain: "redview-31953.firebaseapp.com",
            databaseURL: "https://redview-31953-default-rtdb.firebaseio.com",
            projectId: "redview-31953",
            storageBucket: "redview-31953.firebasestorage.app",
            messagingSenderId: "316847343520",
            appId: "1:316847343520:web:d05a6c2b5cccfd1b57c6c5"
        };

        // Inicializar Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const storage = firebase.storage();

        // Elementos del DOM
        const body = document.body;
        const menuButton = document.getElementById('menuButton');
        const closeMenuButton = document.querySelector('.close-menu');
        const menuOverlay = document.getElementById('menuOverlay');
        const imageUpload = document.getElementById('imageUpload');
        const fileInput = document.getElementById('fileInput');
        const imagePreview = document.getElementById('imagePreview');
        const publishButton = document.getElementById('publishButton');
        const publishFooterButton = document.getElementById('publishFooterButton');
        const backButton = document.getElementById('backButton');
        const joinButton = document.getElementById('joinButton');
        const homeButton = document.getElementById('homeButton');
        const myGroupsButton = document.getElementById('myGroupsButton');
        const myGroupsContainer = document.getElementById('myGroupsContainer');
        const adminButton = document.getElementById('adminButton');
        const requestsContainer = document.getElementById('requestsContainer');
        const adminPublishedContainer = document.getElementById('adminPublishedContainer');
        const mainCardsContainer = document.getElementById('mainCardsContainer');
        const searchIcon = document.getElementById('searchIcon');
        const menuTitle = document.getElementById('menuTitle');
        const editingGroupId = document.getElementById('editingGroupId');
        const editingGroupType = document.getElementById('editingGroupType');
        
        // Elementos de b√∫squeda
        const searchBar = document.getElementById('searchBar');
        const searchInput = document.getElementById('searchInput');
        const closeSearch = document.getElementById('closeSearch');
        
        // Elementos del modal de admin
        const adminTitleButton = document.getElementById('adminTitleButton');
        const adminModalOverlay = document.getElementById('adminModalOverlay');
        const adminModalPassword = document.getElementById('adminModalPassword');
        const adminModalSubmit = document.getElementById('adminModalSubmit');
        const adminModalClose = document.getElementById('adminModalClose');
        
        // Elementos de pesta√±as admin
        const pendingTab = document.getElementById('pendingTab');
        const publishedTab = document.getElementById('publishedTab');
        const notificationsTab = document.getElementById('notificationsTab');
        const pendingContent = document.getElementById('pendingContent');
        const publishedContent = document.getElementById('publishedContent');
        const notificationsContent = document.getElementById('notificationsContent');
        
        // Elementos de estad√≠sticas
        const statsPublished = document.getElementById('statsPublished');
        const statsPending = document.getElementById('statsPending');
        
        // Elementos de loading
        const mainLoading = document.getElementById('mainLoading');
        const myGroupsLoading = document.getElementById('myGroupsLoading');
        const pendingLoading = document.getElementById('pendingLoading');
        const publishedLoading = document.getElementById('publishedLoading');
        const notificationsLoading = document.getElementById('notificationsLoading');
        
        // Elementos de notificaciones
        const sendNotificationButton = document.getElementById('sendNotificationButton');
        const notificationTitle = document.getElementById('notificationTitle');
        const notificationMessage = document.getElementById('notificationMessage');
        const notificationsContainer = document.getElementById('notificationsContainer');
        
        // Variables globales
        let currentUserId = generateUserId();
        let currentGroupDetails = null;
        let isAdmin = false;
        const ADMIN_PASSWORD = '200506';
        let uploadedImageFile = null;
        let isEditing = false;
        let currentEditGroupKey = null;
        let currentEditGroupType = null;
        
        // Generar un ID de usuario √∫nico (simulado)
        function generateUserId() {
            // Intentar recuperar el ID de usuario de localStorage
            let userId = localStorage.getItem('redview_user_id');
            if (!userId) {
                // Si no existe, crear uno nuevo
                userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('redview_user_id', userId);
                
                // Registrar usuario en Firebase
                registerUser(userId);
            }
            return userId;
        }
        
        // Registrar usuario en la carpeta "usuarios" de Firebase
        async function registerUser(userId) {
            try {
                const userRef = database.ref('usuarios/' + userId);
                const snapshot = await userRef.once('value');
                
                if (!snapshot.exists()) {
                    await userRef.set({
                        id: userId,
                        fechaRegistro: new Date().toISOString(),
                        gruposPublicados: 0,
                        ultimaConexion: new Date().toISOString()
                    });
                } else {
                    // Actualizar √∫ltima conexi√≥n
                    await userRef.update({
                        ultimaConexion: new Date().toISOString()
                    });
                }
            } catch (error) {
                console.error('Error registrando usuario:', error);
            }
        }
        
        // Funci√≥n para convertir imagen a base64
        function convertImageToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
        
        // Funci√≥n auxiliar para obtener la fuente de la imagen seg√∫n la estructura de tu base de datos
        function getImageSource(grupo) {
            // Primero revisar si existe 'imagen' (base64 o URL)
            if (grupo.imagen) {
                // Si es una URL base64
                if (grupo.imagen.startsWith('data:image')) {
                    return grupo.imagen;
                }
                // Si es una URL normal (como https://i.ibb.co/99JSCLFS/028866fd0493.jpg)
                else if (grupo.imagen.startsWith('http')) {
                    return grupo.imagen;
                }
            }
            // Luego revisar si existe 'imageBase64'
            else if (grupo.imageBase64 && grupo.imageBase64.startsWith('data:image')) {
                return grupo.imageBase64;
            }
            // Luego revisar si existe 'imageUrl'
            else if (grupo.imageUrl && grupo.imageUrl.startsWith('http')) {
                return grupo.imageUrl;
            }
            // Imagen por defecto
            else {
                return 'https://images.unsplash.com/photo-1552664730-d307ca884978?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80';
            }
        }
        
        // Mostrar/ocultar loading
        function showLoading(loader) {
            if (loader) loader.style.display = 'block';
        }
        
        function hideLoading(loader) {
            if (loader) loader.style.display = 'none';
        }
        
        // Funci√≥n para mostrar/ocultar barra de b√∫squeda
        const toggleSearchBar = (show) => {
            if (show) {
                searchBar.style.display = 'flex';
                searchInput.focus();
            } else {
                searchBar.style.display = 'none';
                searchInput.value = '';
                // Restaurar todas las tarjetas al cerrar la b√∫squeda
                restoreAllCards();
            }
        };
        
        // Funci√≥n para restaurar todas las tarjetas
        const restoreAllCards = () => {
            const cards = document.querySelectorAll('.card');
            cards.forEach(card => {
                card.style.display = 'flex';
            });
        };
        
        // Funci√≥n para filtrar tarjetas por etiquetas
        const filterCardsByTags = (searchTerm) => {
            const cards = document.querySelectorAll('.card');
            const term = searchTerm.toLowerCase().trim();
            
            if (!term) {
                restoreAllCards();
                return;
            }
            
            // Separar t√©rminos de b√∫squeda por comas o espacios
            const searchTerms = term.split(/[, ]+/).filter(t => t.length > 0);
            
            cards.forEach(card => {
                // Obtener las etiquetas del atributo data-tags
                let tags = card.dataset.tags || '';
                
                // Verificar si alguna de las etiquetas coincide con alg√∫n t√©rmino de b√∫squeda
                const hasMatch = searchTerms.some(searchTerm => 
                    tags.includes(searchTerm)
                );
                
                // Tambi√©n buscar en el t√≠tulo y descripci√≥n
                const title = card.querySelector('.card-title')?.textContent.toLowerCase() || '';
                const description = card.querySelector('.card-description')?.textContent.toLowerCase() || '';
                
                const titleMatch = searchTerms.some(searchTerm => title.includes(searchTerm));
                const descriptionMatch = searchTerms.some(searchTerm => description.includes(searchTerm));
                
                // Mostrar u ocultar la tarjeta seg√∫n coincidencia
                if (hasMatch || titleMatch || descriptionMatch) {
                    card.style.display = 'flex';
                } else {
                    card.style.display = 'none';
                }
            });
        };
        
        // Funci√≥n para actualizar la visibilidad de la lupa
        const updateSearchIconVisibility = () => {
            if (body.classList.contains('show-my-groups') || body.classList.contains('show-admin')) {
                searchIcon.style.display = 'none';
            } else {
                searchIcon.style.display = 'block';
            }
        };
        
        // Funci√≥n para actualizar el estado activo de la barra inferior
        const updateBottomBarActive = () => {
            // Remover clase active de todos los botones
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // A√±adir clase active al bot√≥n correspondiente
            if (body.classList.contains('show-my-groups')) {
                myGroupsButton.classList.add('active');
            } else if (body.classList.contains('show-admin')) {
                adminButton.classList.add('active');
            } else {
                homeButton.classList.add('active');
            }
        };
        
        // Abrir men√∫ lateral de publicaci√≥n
        menuButton.addEventListener('click', () => {
            resetPublishForm();
            body.classList.add('menu-open');
            body.classList.remove('show-my-groups');
            body.classList.remove('show-admin');
            updateSearchIconVisibility();
            updateBottomBarActive();
        });
        
        // Cerrar men√∫ lateral de publicaci√≥n
        const closePublishMenu = () => {
            body.classList.remove('menu-open');
            resetPublishForm();
        };
        
        closeMenuButton.addEventListener('click', closePublishMenu);
        
        // Resetear formulario de publicaci√≥n
        function resetPublishForm() {
            isEditing = false;
            currentEditGroupKey = null;
            currentEditGroupType = null;
            editingGroupId.value = '';
            editingGroupType.value = '';
            document.getElementById('groupName').value = '';
            document.getElementById('groupDescription').value = '';
            document.getElementById('groupTags').value = '';
            document.getElementById('groupLink').value = '';
            imagePreview.src = '';
            imageUpload.classList.remove('has-image');
            uploadedImageFile = null;
            fileInput.value = '';
            menuTitle.textContent = 'üìä PUBLICAR MIS GRUPOS';
            publishFooterButton.textContent = 'Publicar grupo';
        }
        
        // Navegaci√≥n entre vistas
        homeButton.addEventListener('click', () => {
            body.classList.remove('show-my-groups');
            body.classList.remove('show-admin');
            updateSearchIconVisibility();
            updateBottomBarActive();
            loadPublishedGroups();
        });
        
        myGroupsButton.addEventListener('click', () => {
            body.classList.add('show-my-groups');
            body.classList.remove('show-admin');
            updateSearchIconVisibility();
            updateBottomBarActive();
            loadMyGroups();
        });
        
        adminButton.addEventListener('click', () => {
            body.classList.add('show-admin');
            body.classList.remove('show-my-groups');
            updateSearchIconVisibility();
            updateBottomBarActive();
            loadAdminData();
        });
        
        // Mostrar barra de b√∫squeda
        searchIcon.addEventListener('click', () => {
            toggleSearchBar(true);
        });
        
        // Cerrar barra de b√∫squeda
        closeSearch.addEventListener('click', () => {
            toggleSearchBar(false);
        });
        
        // Filtrar tarjetas mientras se escribe
        searchInput.addEventListener('input', (e) => {
            filterCardsByTags(e.target.value);
        });
        
        // Cerrar barra de b√∫squeda con tecla Escape
        searchInput.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                toggleSearchBar(false);
            }
        });
        
        // Modal de administrador
        adminTitleButton.addEventListener('click', () => {
            adminModalOverlay.classList.add('active');
            adminModalPassword.focus();
        });
        
        adminModalClose.addEventListener('click', () => {
            closeAdminModal();
        });
        
        adminModalOverlay.addEventListener('click', (e) => {
            if (e.target === adminModalOverlay) {
                closeAdminModal();
            }
        });
        
        adminModalSubmit.addEventListener('click', () => {
            const password = adminModalPassword.value;
            if (password === ADMIN_PASSWORD) {
                isAdmin = true;
                adminButton.style.display = 'flex';
                closeAdminModal();
                alert('Acceso de administrador concedido. Ahora puedes ver el panel de administraci√≥n en la barra inferior.');
            } else {
                alert('Contrase√±a incorrecta');
                adminModalPassword.value = '';
                adminModalPassword.focus();
            }
        });
        
        // Tambi√©n permitir login con Enter
        adminModalPassword.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                adminModalSubmit.click();
            }
        });
        
        // Cerrar modal de admin con Escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && adminModalOverlay.classList.contains('active')) {
                closeAdminModal();
            }
        });
        
        function closeAdminModal() {
            adminModalOverlay.classList.remove('active');
            adminModalPassword.value = '';
        }
        
        // Pesta√±as de administrador
        pendingTab.addEventListener('click', () => {
            pendingTab.classList.add('active');
            publishedTab.classList.remove('active');
            notificationsTab.classList.remove('active');
            pendingContent.classList.add('active');
            publishedContent.classList.remove('active');
            notificationsContent.classList.remove('active');
            loadPendingRequests();
        });
        
        publishedTab.addEventListener('click', () => {
            publishedTab.classList.add('active');
            pendingTab.classList.remove('active');
            notificationsTab.classList.remove('active');
            publishedContent.classList.add('active');
            pendingContent.classList.remove('active');
            notificationsContent.classList.remove('active');
            loadAdminPublishedGroups();
        });
        
        notificationsTab.addEventListener('click', () => {
            notificationsTab.classList.add('active');
            pendingTab.classList.remove('active');
            publishedTab.classList.remove('active');
            notificationsContent.classList.add('active');
            pendingContent.classList.remove('active');
            publishedContent.classList.remove('active');
            loadNotifications();
        });
        
        // Cerrar cualquier men√∫ al hacer clic en el overlay
        menuOverlay.addEventListener('click', () => {
            closePublishMenu();
            closeGroupDetails();
        });
        
        // Seleccionar imagen para publicaci√≥n
        imageUpload.addEventListener('click', () => {
            fileInput.click();
        });
        
        fileInput.addEventListener('change', function() {
            if (this.files && this.files[0]) {
                uploadedImageFile = this.files[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    imagePreview.src = e.target.result;
                    imageUpload.classList.add('has-image');
                };
                
                reader.readAsDataURL(this.files[0]);
            }
        });
        
        // ========== FUNCIONES DE FIREBASE ==========
        
        // Cargar grupos publicados (para todos) - AJUSTADO A TU ESTRUCTURA
        async function loadPublishedGroups() {
            showLoading(mainLoading);
            mainCardsContainer.innerHTML = '';
            
            try {
                const snapshot = await database.ref('grupos').once('value');
                const grupos = snapshot.val();
                
                if (!grupos) {
                    mainCardsContainer.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 40px 20px; color: #bbb;">
                            No hay grupos publicados a√∫n. S√© el primero en publicar un grupo.
                        </div>
                    `;
                    hideLoading(mainLoading);
                    return;
                }
                
                mainCardsContainer.innerHTML = '';
                let index = 0;
                const gruposKeys = new Set(); // Para evitar duplicados
                
                for (const key in grupos) {
                    const grupo = grupos[key];
                    // Verificar si el grupo est√° publicado (estado: "publicado" o status: "approved")
                    // IMPORTANTE: Solo mostrar grupos publicados, no todos
                    const estado = grupo.estado || grupo.status || '';
                    if (estado === "publicado" || estado === "approved") {
                        // Evitar duplicados
                        if (!gruposKeys.has(key)) {
                            gruposKeys.add(key);
                            await createGroupCard(grupo, key, index + 1, mainCardsContainer);
                            index++;
                        }
                    }
                }
                
                if (index === 0) {
                    mainCardsContainer.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 40px 20px; color: #bbb;">
                            No hay grupos publicados a√∫n. S√© el primero en publicar un grupo.
                        </div>
                    `;
                }
                
                hideLoading(mainLoading);
            } catch (error) {
                console.error('Error cargando grupos:', error);
                hideLoading(mainLoading);
                mainCardsContainer.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px 20px; color: #e74c3c;">
                        Error al cargar los grupos. Intenta de nuevo m√°s tarde.
                    </div>
                `;
            }
        }
        
        // Cargar mis grupos (del usuario actual) - AJUSTADO A TU ESTRUCTURA
        async function loadMyGroups() {
            showLoading(myGroupsLoading);
            myGroupsContainer.innerHTML = '';
            
            try {
                // Primero buscar en solicitudes (grupos pendientes del usuario)
                const snapshotSolicitudes = await database.ref('solicitudes').orderByChild('userid').equalTo(currentUserId).once('value');
                const misSolicitudes = snapshotSolicitudes.val();
                
                // Luego buscar en grupos publicados del usuario
                const snapshotGrupos = await database.ref('grupos').orderByChild('userid').equalTo(currentUserId).once('value');
                const misGruposPublicados = snapshotGrupos.val();
                
                if (!misSolicitudes && !misGruposPublicados) {
                    myGroupsContainer.innerHTML = `
                        <div class="my-group-placeholder">
                            <p style="text-align: center; color: #bbb; padding: 40px 20px;">
                                Tus grupos publicados aparecer√°n aqu√≠. Publica tu primer grupo para comenzar.
                            </p>
                        </div>
                    `;
                    hideLoading(myGroupsLoading);
                    return;
                }
                
                myGroupsContainer.innerHTML = '';
                
                // Agregar solicitudes pendientes
                if (misSolicitudes) {
                    for (const key in misSolicitudes) {
                        const grupo = misSolicitudes[key];
                        await createMyGroupCard(grupo, key, 'solicitud');
                    }
                }
                
                // Agregar grupos publicados del usuario
                if (misGruposPublicados) {
                    for (const key in misGruposPublicados) {
                        const grupo = misGruposPublicados[key];
                        await createMyGroupCard(grupo, key, 'grupo');
                    }
                }
                
                hideLoading(myGroupsLoading);
            } catch (error) {
                console.error('Error cargando mis grupos:', error);
                hideLoading(myGroupsLoading);
                myGroupsContainer.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: #e74c3c;">
                        Error al cargar tus grupos.
                    </div>
                `;
            }
        }
        
        // Cargar datos del admin
        async function loadAdminData() {
            await loadPendingRequests();
            await loadAdminPublishedGroups();
            await updateAdminStats();
        }
        
        // Cargar solicitudes pendientes (admin) - AJUSTADO A TU ESTRUCTURA
        async function loadPendingRequests() {
            showLoading(pendingLoading);
            requestsContainer.innerHTML = '';
            
            try {
                const snapshot = await database.ref('solicitudes').once('value');
                const solicitudes = snapshot.val();
                
                if (!solicitudes) {
                    requestsContainer.innerHTML = `
                        <div class="request-placeholder">
                            <p style="text-align: center; color: #bbb; padding: 40px 20px;">
                                No hay solicitudes pendientes. Las solicitudes de publicaci√≥n aparecer√°n aqu√≠.
                            </p>
                        </div>
                    `;
                    hideLoading(pendingLoading);
                    return;
                }
                
                requestsContainer.innerHTML = '';
                
                for (const key in solicitudes) {
                    const solicitud = solicitudes[key];
                    // Mostrar solo solicitudes con estado "pending" o sin estado definido
                    const estado = solicitud.estado || solicitud.status || '';
                    if (estado === "pendiente" || estado === "pending" || estado === "") {
                        await createRequestCard(solicitud, key);
                    }
                }
                
                hideLoading(pendingLoading);
            } catch (error) {
                console.error('Error cargando solicitudes:', error);
                hideLoading(pendingLoading);
                requestsContainer.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: #e74c3c;">
                        Error al cargar las solicitudes.
                    </div>
                `;
            }
        }
        
        // Cargar grupos publicados (admin) - AJUSTADO A TU ESTRUCTURA
        async function loadAdminPublishedGroups() {
            showLoading(publishedLoading);
            adminPublishedContainer.innerHTML = '';
            
            try {
                const snapshot = await database.ref('grupos').once('value');
                const grupos = snapshot.val();
                
                if (!grupos) {
                    adminPublishedContainer.innerHTML = `
                        <div class="published-placeholder">
                            <p style="text-align: center; color: #bbb; padding: 40px 20px;">
                                No hay grupos publicados a√∫n.
                            </p>
                        </div>
                    `;
                    hideLoading(publishedLoading);
                    return;
                }
                
                adminPublishedContainer.innerHTML = '';
                
                for (const key in grupos) {
                    const grupo = grupos[key];
                    // Solo mostrar grupos publicados en el panel de admin tambi√©n
                    const estado = grupo.estado || grupo.status || '';
                    if (estado === "publicado" || estado === "approved") {
                        await createAdminPublishedCard(grupo, key);
                    }
                }
                
                hideLoading(publishedLoading);
            } catch (error) {
                console.error('Error cargando grupos publicados:', error);
                hideLoading(publishedLoading);
                adminPublishedContainer.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: #e74c3c;">
                        Error al cargar los grupos publicados.
                    </div>
                `;
            }
        }
        
        // Cargar notificaciones (admin)
        async function loadNotifications() {
            showLoading(notificationsLoading);
            notificationsContainer.innerHTML = '';
            
            try {
                const snapshot = await database.ref('notificaciones').orderByChild('fecha').limitToLast(20).once('value');
                const notificaciones = snapshot.val();
                
                if (!notificaciones) {
                    notificationsContainer.innerHTML = `
                        <div class="notification-placeholder">
                            <p style="text-align: center; color: #bbb; padding: 40px 20px;">
                                No hay notificaciones enviadas a√∫n.
                            </p>
                        </div>
                    `;
                    hideLoading(notificationsLoading);
                    return;
                }
                
                notificationsContainer.innerHTML = '';
                
                // Convertir objeto a array y ordenar por fecha (m√°s reciente primero)
                const notificacionesArray = [];
                for (const key in notificaciones) {
                    notificacionesArray.push({
                        key: key,
                        ...notificaciones[key]
                    });
                }
                
                notificacionesArray.sort((a, b) => new Date(b.fecha) - new Date(a.fecha));
                
                for (const notificacion of notificacionesArray) {
                    await createNotificationCard(notificacion, notificacion.key);
                }
                
                hideLoading(notificationsLoading);
            } catch (error) {
                console.error('Error cargando notificaciones:', error);
                hideLoading(notificationsLoading);
                notificationsContainer.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: #e74c3c;">
                        Error al cargar las notificaciones.
                    </div>
                `;
            }
        }
        
        // Actualizar estad√≠sticas del admin - AJUSTADO A TU ESTRUCTURA
        async function updateAdminStats() {
            try {
                // Contar grupos publicados (con estado "publicado" o "approved")
                const publishedSnapshot = await database.ref('grupos').once('value');
                let publishedCount = 0;
                const grupos = publishedSnapshot.val();
                
                if (grupos) {
                    for (const key in grupos) {
                        const grupo = grupos[key];
                        const estado = grupo.estado || grupo.status || '';
                        if (estado === "publicado" || estado === "approved") {
                            publishedCount++;
                        }
                    }
                }
                
                // Contar solicitudes pendientes
                const pendingSnapshot = await database.ref('solicitudes').once('value');
                let pendingCount = 0;
                const solicitudes = pendingSnapshot.val();
                
                if (solicitudes) {
                    for (const key in solicitudes) {
                        const solicitud = solicitudes[key];
                        const estado = solicitud.estado || solicitud.status || '';
                        if (estado === "pendiente" || estado === "pending" || estado === "") {
                            pendingCount++;
                        }
                    }
                }
                
                statsPublished.textContent = publishedCount;
                statsPending.textContent = pendingCount;
            } catch (error) {
                console.error('Error actualizando estad√≠sticas:', error);
            }
        }
        
        // Crear tarjeta de grupo para vista principal - AJUSTADO A TU ESTRUCTURA
        async function createGroupCard(grupo, key, groupNumber, container) {
            const groupElement = document.createElement('div');
            groupElement.className = 'card';
            groupElement.setAttribute('data-group', groupNumber);
            groupElement.setAttribute('data-key', key);
            
            // Usar etiquetas (etiquetas o tags)
            const tags = grupo.etiquetas || grupo.tags || '';
            if (tags) {
                groupElement.setAttribute('data-tags', tags.toLowerCase());
            }
            
            // Obtener imagen usando la funci√≥n auxiliar
            const imageSrc = getImageSource(grupo);
            
            // Usar el nombre correcto (nombre o name)
            const nombre = grupo.nombre || grupo.name || 'Sin nombre';
            // Usar la descripci√≥n correcta (descripcion o description)
            const descripcion = grupo.descripcion || grupo.description || 'Sin descripci√≥n';
            
            groupElement.innerHTML = `
                <img src="${imageSrc}" alt="${nombre}" class="card-image">
                <div class="card-content">
                    <h3 class="card-title">${nombre}</h3>
                    <p class="card-description">${descripcion}</p>
                    <button class="card-button" onclick="openGroupDetails('${key}', 'grupo')">Ver</button>
                </div>
            `;
            
            // Agregar evento de clic en toda la tarjeta
            groupElement.addEventListener('click', (e) => {
                if (!e.target.classList.contains('card-button')) {
                    openGroupDetails(key, 'grupo');
                }
            });
            
            container.appendChild(groupElement);
        }
        
        // Crear tarjeta para "Mis Grupos" - AJUSTADO A TU ESTRUCTURA
        async function createMyGroupCard(grupo, key, tipo = 'grupo') {
            const groupElement = document.createElement('div');
            groupElement.className = 'card';
            groupElement.setAttribute('data-key', key);
            groupElement.setAttribute('data-tipo', tipo);
            
            // Usar etiquetas (etiquetas o tags)
            const tags = grupo.etiquetas || grupo.tags || '';
            if (tags) {
                groupElement.setAttribute('data-tags', tags.toLowerCase());
            }
            
            // Determinar clase de estado seg√∫n la estructura
            let statusClass = 'status-review';
            let statusText = 'Revisi√≥n';
            
            const estado = grupo.estado || grupo.status || 'pendiente';
            
            if (estado === "publicado" || estado === "approved") {
                statusClass = 'status-published';
                statusText = 'Publicado';
            } else if (estado === "rechazado" || estado === "rejected") {
                statusClass = 'status-rejected';
                statusText = 'Rechazado';
            } else if (estado === "pendiente" || estado === "pending") {
                statusClass = 'status-review';
                statusText = 'Revisi√≥n';
            }
            
            // Obtener imagen usando la funci√≥n auxiliar
            const imageSrc = getImageSource(grupo);
            
            // Usar el nombre correcto (nombre o name)
            const nombre = grupo.nombre || grupo.name || 'Sin nombre';
            // Usar la descripci√≥n correcta (descripcion o description)
            const descripcion = grupo.descripcion || grupo.description || 'Sin descripci√≥n';
            
            // Estad√≠sticas (vistas o views, uniones o members) - SIN VALORES ALEATORIOS
            const views = grupo.vistas || grupo.views || 0;
            const members = grupo.uniones || grupo.members || 0;
            
            // Formatear etiquetas para mostrar
            const tagsArray = tags ? tags.split(',').map(tag => tag.trim()).filter(tag => tag.length > 0) : [];
            
            groupElement.innerHTML = `
                <img src="${imageSrc}" alt="${nombre}" class="card-image">
                <div class="card-content">
                    <h3 class="card-title">${nombre}</h3>
                    <p class="card-description">${descripcion}</p>
                    
                    <!-- ETIQUETAS ALINEADAS A LA IZQUIERDA -->
                    <div class="my-group-tags">
                        ${tagsArray.map(tag => `<span class="my-group-tag">${tag}</span>`).join('')}
                    </div>
                    
                    <!-- PIE DE TARJETA CON DOS COLUMNAS -->
                    <div class="my-group-footer">
                        <!-- ESTAD√çSTICAS EN LADO IZQUIERDO -->
                        <div class="my-group-stats">
                            <div class="my-group-stat">
                                <div class="my-group-stat-number">${views}</div>
                                <div class="my-group-stat-label">Visualizaciones</div>
                            </div>
                            <div class="my-group-stat">
                                <div class="my-group-stat-number">${members}</div>
                                <div class="my-group-stat-label">Uniones</div>
                            </div>
                        </div>
                        
                        <!-- ESTADO EN LADO DERECHO -->
                        <div class="group-status ${statusClass}">${statusText}</div>
                    </div>
                    
                    <!-- ACCIONES: EDITAR Y ELIMINAR -->
                    <div class="my-group-actions">
                        <button class="edit-group-btn" data-key="${key}" data-tipo="${tipo}">Editar</button>
                        <button class="delete-group-btn" data-key="${key}" data-tipo="${tipo}">Eliminar</button>
                    </div>
                </div>
            `;
            
            // Remover placeholder si existe
            const placeholder = document.querySelector('.my-group-placeholder');
            if (placeholder) {
                placeholder.remove();
            }
            
            myGroupsContainer.prepend(groupElement);
            
            // Agregar eventos a los botones
            groupElement.querySelector('.edit-group-btn').addEventListener('click', function(e) {
                e.stopPropagation();
                const key = this.getAttribute('data-key');
                const tipo = this.getAttribute('data-tipo');
                loadGroupForEdit(key, tipo);
            });
            
            groupElement.querySelector('.delete-group-btn').addEventListener('click', function(e) {
                e.stopPropagation();
                const key = this.getAttribute('data-key');
                const tipo = this.getAttribute('data-tipo');
                deleteGroup(key, tipo);
            });
        }
        
        // Crear tarjeta de solicitud para admin - AJUSTADO A TU ESTRUCTURA
        async function createRequestCard(solicitud, key) {
            const requestElement = document.createElement('div');
            requestElement.className = 'request-item';
            requestElement.dataset.id = key;
            
            // Usar etiquetas (etiquetas o tags)
            const tags = solicitud.etiquetas || solicitud.tags || '';
            if (tags) {
                requestElement.setAttribute('data-tags', tags.toLowerCase());
            }
            
            // Obtener imagen usando la funci√≥n auxiliar
            const imageSrc = getImageSource(solicitud);
            
            // Usar el nombre correcto (nombre o name)
            const nombre = solicitud.nombre || solicitud.name || 'Sin nombre';
            // Usar la descripci√≥n correcta (descripcion o description)
            const descripcion = solicitud.descripcion || solicitud.description || 'Sin descripci√≥n';
            
            // Formatear fecha (fecha o timestamp)
            let date = 'Fecha no disponible';
            if (solicitud.fecha) {
                date = new Date(solicitud.fecha).toLocaleDateString('es-ES', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } else if (solicitud.timestamp) {
                date = new Date(solicitud.timestamp).toLocaleDateString('es-ES', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
            
            // Usar enlace (enlace o link)
            const enlace = solicitud.enlace || solicitud.link || '#';
            
            // Formatear etiquetas para mostrar
            const tagsArray = tags ? tags.split(',').map(tag => tag.trim()).filter(tag => tag.length > 0) : [];
            
            requestElement.innerHTML = `
                <div class="request-header">
                    <h3 class="request-title">${nombre}</h3>
                    <div class="request-date">${date}</div>
                </div>
                <div class="request-image-container">
                    <img src="${imageSrc}" alt="${nombre}" class="request-image">
                </div>
                <p class="request-description">${descripcion}</p>
                <div class="request-tags">
                    ${tagsArray.map(tag => `<span class="request-tag">${tag}</span>`).join('')}
                </div>
                <div class="request-actions">
                    <a href="${enlace}" target="_blank" class="review-link-btn">Revisar Enlace</a>
                    <button class="reject-btn" onclick="rejectRequest('${key}')">Rechazar</button>
                    <button class="accept-btn" onclick="acceptRequest('${key}')">Aceptar</button>
                </div>
            `;
            
            requestsContainer.appendChild(requestElement);
        }
        
        // Crear tarjeta de grupo publicado para admin - AJUSTADO A TU ESTRUCTURA
        async function createAdminPublishedCard(grupo, key) {
            const groupElement = document.createElement('div');
            groupElement.className = 'card';
            groupElement.setAttribute('data-key', key);
            
            // Usar etiquetas (etiquetas o tags)
            const tags = grupo.etiquetas || grupo.tags || '';
            if (tags) {
                groupElement.setAttribute('data-tags', tags.toLowerCase());
            }
            
            // Obtener imagen usando la funci√≥n auxiliar
            const imageSrc = getImageSource(grupo);
            
            // Usar el nombre correcto (nombre o name)
            const nombre = grupo.nombre || grupo.name || 'Sin nombre';
            // Usar la descripci√≥n correcta (descripcion o description)
            const descripcion = grupo.descripcion || grupo.description || 'Sin descripci√≥n';
            
            // Estad√≠sticas (vistas o views, uniones o members) - SIN VALORES ALEATORIOS
            const views = grupo.vistas || grupo.views || 0;
            const members = grupo.uniones || grupo.members || 0;
            
            // Formatear etiquetas para mostrar
            const tagsArray = tags ? tags.split(',').map(tag => tag.trim()).filter(tag => tag.length > 0) : [];
            
            groupElement.innerHTML = `
                <img src="${imageSrc}" alt="${nombre}" class="card-image">
                <div class="card-content">
                    <h3 class="card-title">${nombre}</h3>
                    <p class="card-description">${descripcion}</p>
                    
                    <div class="my-group-tags">
                        ${tagsArray.map(tag => `<span class="my-group-tag">${tag}</span>`).join('')}
                    </div>
                    
                    <div class="my-group-footer">
                        <div class="my-group-stats">
                            <div class="my-group-stat">
                                <div class="my-group-stat-number">${views}</div>
                                <div class="my-group-stat-label">Visualizaciones</div>
                            </div>
                            <div class="my-group-stat">
                                <div class="my-group-stat-number">${members}</div>
                                <div class="my-group-stat-label">Uniones</div>
                            </div>
                        </div>
                        
                        <div class="group-status status-published">Publicado</div>
                    </div>
                    
                    <!-- BOT√ìN PARA ELIMINAR GRUPO PUBLICADO DESDE ADMIN -->
                    <button class="admin-delete-btn" data-key="${key}">Eliminar Grupo</button>
                </div>
            `;
            
            adminPublishedContainer.appendChild(groupElement);
            
            // Agregar evento al bot√≥n de eliminar
            groupElement.querySelector('.admin-delete-btn').addEventListener('click', function(e) {
                e.stopPropagation();
                const key = this.getAttribute('data-key');
                deletePublishedGroupFromAdmin(key);
            });
        }
        
        // Crear tarjeta de notificaci√≥n
        async function createNotificationCard(notificacion, key) {
            const notificationElement = document.createElement('div');
            notificationElement.className = 'notification-item';
            notificationElement.dataset.id = key;
            
            const title = notificacion.titulo || 'Notificaci√≥n';
            const message = notificacion.mensaje || notificacion.message || '';
            const date = new Date(notificacion.fecha).toLocaleDateString('es-ES', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            notificationElement.innerHTML = `
                <div class="notification-header">
                    <h3 class="notification-title">${title}</h3>
                    <div class="notification-date">${date}</div>
                </div>
                <p class="notification-message">${message}</p>
                <button class="delete-notification-btn" data-key="${key}">Eliminar Notificaci√≥n</button>
            `;
            
            notificationsContainer.appendChild(notificationElement);
            
            // Agregar evento al bot√≥n de eliminar
            notificationElement.querySelector('.delete-notification-btn').addEventListener('click', function(e) {
                e.stopPropagation();
                const key = this.getAttribute('data-key');
                deleteNotification(key);
            });
        }
        
        // Cargar grupo para editar
        async function loadGroupForEdit(key, tipo) {
            try {
                let grupo;
                
                if (tipo === 'grupo') {
                    const snapshot = await database.ref('grupos/' + key).once('value');
                    grupo = snapshot.val();
                } else {
                    const snapshot = await database.ref('solicitudes/' + key).once('value');
                    grupo = snapshot.val();
                }
                
                if (!grupo) return;
                
                // Configurar modo edici√≥n
                isEditing = true;
                currentEditGroupKey = key;
                currentEditGroupType = tipo;
                editingGroupId.value = key;
                editingGroupType.value = tipo;
                
                // Cargar datos en el formulario
                document.getElementById('groupName').value = grupo.nombre || grupo.name || '';
                document.getElementById('groupDescription').value = grupo.descripcion || grupo.description || '';
                document.getElementById('groupTags').value = grupo.etiquetas || grupo.tags || '';
                document.getElementById('groupLink').value = grupo.enlace || grupo.link || '';
                
                // Cargar imagen si existe
                const imageSrc = getImageSource(grupo);
                if (imageSrc && imageSrc.startsWith('data:image')) {
                    imagePreview.src = imageSrc;
                    imageUpload.classList.add('has-image');
                } else if (imageSrc && imageSrc.startsWith('http')) {
                    // Para URLs externas, mostramos la imagen directamente
                    imagePreview.src = imageSrc;
                    imageUpload.classList.add('has-image');
                } else {
                    imagePreview.src = '';
                    imageUpload.classList.remove('has-image');
                }
                
                uploadedImageFile = null;
                
                // Cambiar t√≠tulo y texto del bot√≥n
                menuTitle.textContent = '‚úèÔ∏è ·¥á·¥Ö…™·¥õ·¥Ä Ä …¢ Ä·¥ú·¥ò·¥è';
                publishFooterButton.textContent = 'Actualizar y enviar a revisi√≥n';
                
                // Abrir men√∫ de publicaci√≥n
                body.classList.add('menu-open');
                body.classList.remove('show-my-groups');
                body.classList.remove('show-admin');
                updateSearchIconVisibility();
                updateBottomBarActive();
                
            } catch (error) {
                console.error('Error cargando grupo para editar:', error);
                alert('Error al cargar el grupo para editar');
            }
        }
        
        // Eliminar grupo
        async function deleteGroup(key, tipo) {
            if (!confirm('¬øEst√°s seguro de que quieres eliminar este grupo?')) return;
            
            try {
                if (tipo === 'grupo') {
                    await database.ref('grupos/' + key).remove();
                } else {
                    await database.ref('solicitudes/' + key).remove();
                }
                
                alert('Grupo eliminado exitosamente');
                
                // Recargar mis grupos
                await loadMyGroups();
                
                // Si era un grupo publicado, recargar tambi√©n la vista principal
                if (tipo === 'grupo') {
                    await loadPublishedGroups();
                }
                
            } catch (error) {
                console.error('Error eliminando grupo:', error);
                alert('Error al eliminar el grupo');
            }
        }
        
        // Eliminar grupo publicado desde el panel de admin
        async function deletePublishedGroupFromAdmin(key) {
            if (!confirm('¬øEst√°s seguro de que quieres eliminar este grupo publicado? Esta acci√≥n no se puede deshacer.')) return;
            
            try {
                await database.ref('grupos/' + key).remove();
                
                alert('Grupo eliminado exitosamente');
                
                // Recargar la vista
                await loadAdminPublishedGroups();
                await loadPublishedGroups();
                await updateAdminStats();
                
            } catch (error) {
                console.error('Error eliminando grupo publicado:', error);
                alert('Error al eliminar el grupo');
            }
        }
        
        // Eliminar notificaci√≥n
        async function deleteNotification(key) {
            if (!confirm('¬øEst√°s seguro de que quieres eliminar esta notificaci√≥n?')) return;
            
            try {
                await database.ref('notificaciones/' + key).remove();
                
                alert('Notificaci√≥n eliminada exitosamente');
                
                // Recargar notificaciones
                await loadNotifications();
                
            } catch (error) {
                console.error('Error eliminando notificaci√≥n:', error);
                alert('Error al eliminar la notificaci√≥n');
            }
        }
        
        // Abrir detalles del grupo - AJUSTADO A TU ESTRUCTURA
        async function openGroupDetails(key, type) {
            try {
                let grupo;
                
                if (type === 'grupo') {
                    const snapshot = await database.ref('grupos/' + key).once('value');
                    grupo = snapshot.val();
                } else {
                    const snapshot = await database.ref('solicitudes/' + key).once('value');
                    grupo = snapshot.val();
                }
                
                if (!grupo) return;
                
                currentGroupDetails = { key, grupo, type };
                
                // Actualizar UI con datos del grupo
                const nombre = grupo.nombre || grupo.name || 'Sin nombre';
                const descripcion = grupo.descripcion || grupo.description || 'Sin descripci√≥n';
                const enlace = grupo.enlace || grupo.link || '#';
                
                document.getElementById('groupTitle').textContent = nombre;
                document.getElementById('groupDescriptionDetails').textContent = descripcion;
                document.getElementById('joinButton').href = enlace;
                
                // Obtener imagen usando la funci√≥n auxiliar
                const imageSrc = getImageSource(grupo);
                document.getElementById('groupImageLarge').src = imageSrc;
                
                // Formatear fecha
                let fecha = 'Fecha no disponible';
                if (grupo.fecha) {
                    fecha = new Date(grupo.fecha).toLocaleDateString('es-ES', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                    document.getElementById('publishDate').textContent = `Publicado: ${fecha}`;
                } else if (grupo.timestamp) {
                    fecha = new Date(grupo.timestamp).toLocaleDateString('es-ES', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                    document.getElementById('publishDate').textContent = `Publicado: ${fecha}`;
                } else {
                    document.getElementById('publishDate').textContent = 'Fecha no disponible';
                }
                
                // Actualizar etiquetas
                const tagsContainer = document.getElementById('groupTagsDetails');
                tagsContainer.innerHTML = '';
                const tags = grupo.etiquetas || grupo.tags || '';
                if (tags) {
                    tags.split(',').forEach(tag => {
                        const trimmedTag = tag.trim();
                        if (trimmedTag) {
                            const span = document.createElement('span');
                            span.className = 'tag';
                            span.textContent = trimmedTag;
                            tagsContainer.appendChild(span);
                        }
                    });
                }
                
                // Actualizar estad√≠sticas - SIN VALORES ALEATORIOS
                const views = grupo.vistas || grupo.views || 0;
                const members = grupo.uniones || grupo.members || 0;
                
                document.getElementById('viewsCount').textContent = views;
                document.getElementById('membersCount').textContent = members;
                
                body.classList.add('group-details-open');
            } catch (error) {
                console.error('Error abriendo detalles del grupo:', error);
                alert('Error al cargar los detalles del grupo');
            }
        }
        
        // Cerrar detalles del grupo
        const closeGroupDetails = () => {
            body.classList.remove('group-details-open');
        };
        
        backButton.addEventListener('click', closeGroupDetails);
        
        // Aceptar solicitud (admin) - AJUSTADO A TU ESTRUCTURA
        window.acceptRequest = async function(requestKey) {
            if (!confirm('¬øEst√°s seguro de que quieres aceptar esta solicitud?')) return;
            
            try {
                // Obtener la solicitud
                const snapshot = await database.ref('solicitudes/' + requestKey).once('value');
                const solicitud = snapshot.val();
                
                if (!solicitud) {
                    alert('No se encontr√≥ la solicitud');
                    return;
                }
                
                // Crear objeto de grupo aprobado seg√∫n tu estructura
                const grupoAprobado = {
                    nombre: solicitud.nombre || solicitud.name || 'Sin nombre',
                    descripcion: solicitud.descripcion || solicitud.description || 'Sin descripci√≥n',
                    etiquetas: solicitud.etiquetas || solicitud.tags || '',
                    enlace: solicitud.enlace || solicitud.link || '#',
                    imagen: solicitud.imagen || solicitud.imageBase64 || null,
                    userid: solicitud.userid || solicitud.userId || currentUserId,
                    estado: "publicado",
                    fecha: new Date().toISOString(),
                    fechaModificacion: new Date().toISOString(),
                    vistas: solicitud.vistas || solicitud.views || 0, // SIN VALORES ALEATORIOS
                    uniones: solicitud.uniones || solicitud.members || 0, // SIN VALORES ALEATORIOS
                    corazones: solicitud.corazones || 0
                };
                
                // Agregar a grupos aprobados
                const newGroupRef = database.ref('grupos').push();
                await newGroupRef.set(grupoAprobado);
                
                // Actualizar estado de la solicitud
                await database.ref('solicitudes/' + requestKey).update({
                    estado: "publicado",
                    status: "approved",
                    fechaModificacion: new Date().toISOString()
                });
                
                // Actualizar estad√≠sticas y vista
                await updateAdminStats();
                await loadPendingRequests();
                await loadAdminPublishedGroups();
                await loadPublishedGroups();
                
                alert('Solicitud aceptada y publicada exitosamente');
            } catch (error) {
                console.error('Error aceptando solicitud:', error);
                alert('Error al aceptar la solicitud');
            }
        };
        
        // Rechazar solicitud (admin) - AJUSTADO A TU ESTRUCTURA
        window.rejectRequest = async function(requestKey) {
            if (!confirm('¬øEst√°s seguro de que quieres rechazar esta solicitud?')) return;
            
            try {
                // Actualizar estado de la solicitud
                await database.ref('solicitudes/' + requestKey).update({
                    estado: "rechazado",
                    status: "rejected",
                    fechaModificacion: new Date().toISOString()
                });
                
                // Actualizar estad√≠sticas y vista
                await updateAdminStats();
                await loadPendingRequests();
                
                alert('Solicitud rechazada exitosamente');
            } catch (error) {
                console.error('Error rechazando solicitud:', error);
                alert('Error al rechazar la solicitud');
            }
        };
        
        // Enviar notificaci√≥n a todos los usuarios
        sendNotificationButton.addEventListener('click', async () => {
            const title = notificationTitle.value.trim();
            const message = notificationMessage.value.trim();
            
            if (!message) {
                alert('Por favor, ingresa un mensaje para la notificaci√≥n');
                return;
            }
            
            // Deshabilitar bot√≥n mientras se env√≠a
            sendNotificationButton.disabled = true;
            sendNotificationButton.textContent = 'Enviando...';
            
            try {
                const notificacion = {
                    titulo: title || 'Notificaci√≥n del Administrador',
                    mensaje: message,
                    fecha: new Date().toISOString(),
                    enviadoPor: 'admin',
                    userId: currentUserId
                };
                
                await database.ref('notificaciones').push(notificacion);
                
                // Limpiar formulario
                notificationTitle.value = '';
                notificationMessage.value = '';
                
                alert('Notificaci√≥n enviada exitosamente a todos los usuarios');
                
                // Recargar notificaciones
                await loadNotifications();
                
            } catch (error) {
                console.error('Error enviando notificaci√≥n:', error);
                alert('Error al enviar la notificaci√≥n');
            } finally {
                // Restaurar bot√≥n
                sendNotificationButton.disabled = false;
                sendNotificationButton.textContent = 'Enviar Notificaci√≥n';
            }
        });
        
        // Publicar o actualizar grupo (usuario) - AJUSTADO A TU ESTRUCTURA
        publishFooterButton.addEventListener('click', async () => {
            const groupName = document.getElementById('groupName').value.trim();
            const groupDescription = document.getElementById('groupDescription').value.trim();
            const groupTags = document.getElementById('groupTags').value.trim();
            const groupLink = document.getElementById('groupLink').value.trim();
            
            // Validaciones
            if (!groupName) {
                alert('Por favor, ingresa un nombre para el grupo');
                return;
            }
            
            if (!groupDescription) {
                alert('Por favor, ingresa una descripci√≥n para el grupo');
                return;
            }
            
            if (!groupTags) {
                alert('Por favor, ingresa al menos una etiqueta para el grupo');
                return;
            }
            
            if (!groupLink) {
                alert('Por favor, ingresa un enlace para el grupo');
                return;
            }
            
            // Validar URL
            try {
                new URL(groupLink);
            } catch (e) {
                alert('Por favor, ingresa una URL v√°lida');
                return;
            }
            
            // Mostrar mensaje de carga
            publishFooterButton.disabled = true;
            publishFooterButton.textContent = isEditing ? 'Actualizando...' : 'Publicando...';
            
            try {
                let imagenBase64 = null;
                
                // Convertir imagen a base64 si hay una seleccionada
                if (uploadedImageFile) {
                    imagenBase64 = await convertImageToBase64(uploadedImageFile);
                } else if (isEditing) {
                    // Si estamos editando y no se subi√≥ nueva imagen, mantener la existente
                    let grupoExistente;
                    if (currentEditGroupType === 'grupo') {
                        const snapshot = await database.ref('grupos/' + currentEditGroupKey).once('value');
                        grupoExistente = snapshot.val();
                    } else {
                        const snapshot = await database.ref('solicitudes/' + currentEditGroupKey).once('value');
                        grupoExistente = snapshot.val();
                    }
                    
                    if (grupoExistente) {
                        imagenBase64 = grupoExistente.imagen || grupoExistente.imageBase64 || null;
                    }
                }
                
                if (isEditing) {
                    // MODO EDICI√ìN: Enviar a revisi√≥n nuevamente
                    const solicitudActualizada = {
                        nombre: groupName,
                        descripcion: groupDescription,
                        etiquetas: groupTags,
                        enlace: groupLink,
                        imagen: imagenBase64,
                        userid: currentUserId,
                        estado: "pendiente",
                        fecha: new Date().toISOString(),
                        fechaModificacion: new Date().toISOString(),
                        vistas: 0, // SIN VALORES ALEATORIOS
                        uniones: 0, // SIN VALORES ALEATORIOS
                        corazones: 0
                    };
                    
                    // Si el grupo estaba publicado, eliminarlo de "grupos"
                    if (currentEditGroupType === 'grupo') {
                        await database.ref('grupos/' + currentEditGroupKey).remove();
                    }
                    
                    // Crear nueva solicitud (o actualizar si ya era una solicitud)
                    if (currentEditGroupType === 'solicitud') {
                        await database.ref('solicitudes/' + currentEditGroupKey).update(solicitudActualizada);
                    } else {
                        await database.ref('solicitudes').push(solicitudActualizada);
                    }
                    
                    // Cerrar men√∫
                    closePublishMenu();
                    
                    // Mostrar mensaje de √©xito
                    alert('Grupo actualizado y enviado para revisi√≥n. Se ha quitado de la vista p√∫blica hasta que sea aprobado nuevamente.');
                    
                    // Recargar "Mis grupos" y vista principal
                    await loadMyGroups();
                    await loadPublishedGroups();
                    
                } else {
                    // MODO CREACI√ìN: Nueva publicaci√≥n
                    const solicitud = {
                        nombre: groupName,
                        descripcion: groupDescription,
                        etiquetas: groupTags,
                        enlace: groupLink,
                        imagen: imagenBase64,
                        userid: currentUserId,
                        estado: "pendiente",
                        fecha: new Date().toISOString(),
                        vistas: 0, // SIN VALORES ALEATORIOS
                        uniones: 0, // SIN VALORES ALEATORIOS
                        corazones: 0
                    };
                    
                    await database.ref('solicitudes').push(solicitud);
                    
                    // Limpiar formulario
                    resetPublishForm();
                    
                    // Cerrar men√∫
                    closePublishMenu();
                    
                    alert('¬°Grupo enviado para revisi√≥n! Un administrador lo revisar√° pronto.');
                    
                    // Cambiar a la vista de "Mis Grupos"
                    body.classList.add('show-my-groups');
                    updateSearchIconVisibility();
                    updateBottomBarActive();
                    
                    await loadMyGroups();
                }
                
            } catch (error) {
                console.error('Error publicando/actualizando grupo:', error);
                alert('Error al procesar el grupo. Intenta de nuevo.');
            } finally {
                // Restaurar bot√≥n
                publishFooterButton.disabled = false;
                publishFooterButton.textContent = isEditing ? 'Actualizar y enviar a revisi√≥n' : 'Publicar grupo';
            }
        });
        
        // Cerrar men√∫s con tecla Escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                if (body.classList.contains('menu-open')) {
                    closePublishMenu();
                }
                if (body.classList.contains('group-details-open')) {
                    closeGroupDetails();
                }
                if (searchBar.style.display === 'flex') {
                    toggleSearchBar(false);
                }
            }
        });
        
        // Inicializar la aplicaci√≥n
        window.addEventListener('DOMContentLoaded', async () => {
            // Registrar usuario y obtener/crear ID
            await registerUser(currentUserId);
            
            // Cargar grupos publicados al inicio
            await loadPublishedGroups();
            
            // Inicializar visibilidad de lupa
            updateSearchIconVisibility();
            
            // Inicializar estado activo de barra inferior
            updateBottomBarActive();
        });
    </script>
</body>
</html>
